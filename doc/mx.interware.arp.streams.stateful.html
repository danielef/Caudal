<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>mx.interware.arp.streams.stateful documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Arp 1.1.0 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mx</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interware</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>arp</span></div></div></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></div></li><li class="depth-5 branch"><a href="mx.interware.arp.core.atom-state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>atom-state</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.email.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>email</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.folds.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>folds</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.global.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>global</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.immutant-avout.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>immutant-avout</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.immutant-state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>immutant-state</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.listener.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>listener</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.main.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>main</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.parsers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>parsers</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.repl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>repl</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.scheduler-server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scheduler-server</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.core.starter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>starter</span></div></a></li><li class="depth-5"><a href="mx.interware.arp.core.state.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>state</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree" style="top: -424px;"><span class="top" style="height: 433px;"></span><span class="bottom"></span></span><span>io</span></div></div></li><li class="depth-5 branch"><a href="mx.interware.arp.io.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.io.elastic.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>elastic</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.io.kafka.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kafka</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.io.log-feed-simulator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>log-feed-simulator</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.io.log4j-server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>log4j-server</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.io.server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.io.syslog-server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>syslog-server</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.io.tailer-server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tailer-server</span></div></a></li><li class="depth-5"><a href="mx.interware.arp.io.tcp-server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tcp-server</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree" style="top: -300px;"><span class="top" style="height: 309px;"></span><span class="bottom"></span></span><span>streams</span></div></div></li><li class="depth-5 branch"><a href="mx.interware.arp.streams.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-5 branch current"><a href="mx.interware.arp.streams.stateful.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stateful</span></div></a></li><li class="depth-5"><a href="mx.interware.arp.streams.stateless.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stateless</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>test</span></div></div></li><li class="depth-5 branch"><a href="mx.interware.arp.test.simple-config.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>simple-config</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.test.simple-parser.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>simple-parser</span></div></a></li><li class="depth-5"><a href="mx.interware.arp.test.testers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>testers</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>util</span></div></div></li><li class="depth-5 branch"><a href="mx.interware.arp.util.arp-util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>arp-util</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.util.date-util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>date-util</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.util.id-util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>id-util</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.util.matrix.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>matrix</span></div></a></li><li class="depth-5 branch"><a href="mx.interware.arp.util.ns-util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ns-util</span></div></a></li><li class="depth-5"><a href="mx.interware.arp.util.rest-util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rest-util</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-acum-stats"><div class="inner"><span>acum-stats</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-batch"><div class="inner"><span>batch</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-changed"><div class="inner"><span>changed</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-concurrent-meter"><div class="inner"><span>concurrent-meter</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-counter"><div class="inner"><span>counter</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-dump-every"><div class="inner"><span>dump-every</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-ewma-timeless"><div class="inner"><span>ewma-timeless</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-log-matcher"><div class="inner"><span>log-matcher</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-mixer"><div class="inner"><span>mixer</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-moving-time-window"><div class="inner"><span>moving-time-window</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-rate"><div class="inner"><span>rate</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-reduce-with"><div class="inner"><span>reduce-with</span></div></a></li><li class="depth-1"><a href="mx.interware.arp.streams.stateful.html#var-rollup"><div class="inner"><span>rollup</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">mx.interware.arp.streams.stateful</h2><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-acum-stats"><h3>acum-stats</h3><div class="usage"><code>(acum-stats state-key avg-key variance-key stdev-key count-key &amp; children)</code></div><div class="doc"><div class="markdown"><p>Stream function that acumulates stats (mean,variance,stdev,count) recomputing them, it receives an event that is decorated with mean,stdev,variance and count and takes information from the state and the resultin mixing is stored in the state, then the event with the new values is propagated to children</p>
<blockquote><p><strong>Arguments</strong>:<br/><em>state-key</em>: Key name to store accumulating mean,stdev,variance and count <em>avg-key</em>: Key where the mean is in the event and in the state<br/><em>variance-key</em>: Key where the variance is in the event and in the state<br/><em>stdev-key</em>: Key where the stdev is in the event and in the state<br/><em>count-key</em>: Key where the count is in the event and in the state<br/><em>children</em>: List of streams to propagate result<br/>&ndash; if event is missign required fields, the event is propagated with :error set to message error </p>
</blockquote></div></div></div><div class="public anchor" id="var-batch"><h3>batch</h3><div class="usage"><code>(batch state-key n dt &amp; children)</code></div><div class="doc"><div class="markdown"><p>Streamer function that propagates a vector of events once n elements are stored in or dt time has passed </p>
<blockquote><p><strong>Arguments</strong>:<br/><em>state-key</em>: Key name to store<br/><em>n</em>: Max number of elements stored<br/><em>dt</em>: Max time to propagate<br/><em>children</em>: Children streamer functions to be propagated </p>
</blockquote></div></div></div><div class="public anchor" id="var-changed"><h3>changed</h3><div class="usage"><code>(changed state-key change-pred &amp; children)</code></div><div class="doc"><div class="markdown"><p>Streamer function that checks if a value of an event has changed using a predicate </p>
<blockquote><p><strong>Arguments</strong>:<br/> <em>state-key</em>: State key to store<br/> <em>change-pred</em>: predicate for evaluating<br/> <em>children</em>: Children streamer functions to be propagated </p>
</blockquote></div></div></div><div class="public anchor" id="var-concurrent-meter"><h3>concurrent-meter</h3><div class="usage"><code>(concurrent-meter state-key init-tx-pred end-tx-pred tx-id-fn &amp; [concurrent-fld-cntr &amp; children :as all-children])</code></div><div class="doc"><div class="markdown"><p>Stream function that stores in event the current number of transactions opened<br/>when an initial event passes, the counter increments, if an end event paseses, the counter decrements </p>
<blockquote><p><strong>Arguments</strong>:<br/><em>state-key</em>: State key name to store the counter<br/><em>init-tx-pred</em>: Predicate to detect the initial event of an operation<br/><em>init-tx-end</em>: Predicate to detect the finish event of an operation<br/>*tx-id-fn: Function to get the transaction id<br/>*[]: list that contains: - event key name to store the meter<br/>- children functions to propagate</p>
</blockquote></div></div></div><div class="public anchor" id="var-counter"><h3>counter</h3><div class="usage"><code>(counter state-key event-counter-key &amp; children)</code></div><div class="doc"><div class="markdown"><p>Streamer function that appends to an event the count of passed events </p>
<blockquote><p><strong>Arguments</strong>:<br/> <em>state-key</em>: State key to store the count<br/> <em>event-counter-key</em>: Event key to hold the count<br/> <em>children</em>: Children streamer functions to be propagated </p>
</blockquote></div></div></div><div class="public anchor" id="var-dump-every"><h3>dump-every</h3><div class="usage"><code>(dump-every state-key file-name-prefix date-format cycle dir-path)</code></div><div class="doc"><div class="markdown"><p>Stream function that writes to the file system information stored y the state. </p>
<blockquote><p><strong>Arguments</strong>:<br/><em>state-key</em>: Key of the state to write to the file system<br/><em>file-name-prefix</em>, <em>date-format</em> and <em>dir-path</em>: are used to copute the file name like this:<br/>- Arquimedes take the JVM time and formats it using a java.text.SimpleDateFormat with <em>date-format</em> and - concatenates it with &lsquo;-&rsquo; and file-name-prefix, then appends to it the current <em>&lsquo;by string list&rsquo;</em> then - appends &lsquo;.edn&rsquo; the file will be located at the <em>dir-path</em> directory.<br/><em>cycle</em>: represents a long number for milliseconds or a vetor with a number ant time messure like:<br/>- [5 :minutes] or [1 :day]<br/>- <em>cycle</em> will thel arquimedes to write this file width this frequency posibly overwriting it. </p>
</blockquote></div></div></div><div class="public anchor" id="var-ewma-timeless"><h3>ewma-timeless</h3><div class="usage"><code>(ewma-timeless state-key r &amp; [metric-key &amp; children :as all-children])</code></div><div class="doc"><div class="markdown"><p>Streamer function that normalizes the metric value, it calculates the ewma which represents the exponential waited moving average and is calculated by the next equation:<br/>(last-metric * r) + (metric-history * (1-r)), events with no metric will be ignored  </p>
<blockquote><p><strong>Arguments</strong>:<br/><em>state-key</em>: state key to store the metric<br/><em>r</em>: Ratio value<br/><em>(metric-key)</em>: Optional for key holding metric, default :metric <em>children</em> the streamer functions to propagate </p>
</blockquote></div></div></div><div class="public anchor" id="var-log-matcher"><h3>log-matcher</h3><div class="usage"><code>(log-matcher state-key init-pred end-pred tx-id-fn timeout-delta &amp; [ts-key &amp; children :as all-children])</code></div><div class="doc"><div class="markdown"><p>Stream function that correlates initial and end events, extract the metric value and calculates the metric difference </p>
<blockquote><p><strong>Arguments</strong>:<br/><em>state-key</em>: Key name to store the time<br/><em>init-tx-pred</em>: Predicate to detect the initial event of an operation<br/><em>init-tx-end</em>: Predicate to detect the finish event of an operation<br/><em>tx-id-fn</em>: Function to get the transaction id<br/><em>timeout-delta</em>: Time to wait the end event in milliseconds, when timeout, it will discard the event<br/><em>[]</em>:List that contains the key name to store the difference miliseconds and childs to propagate </p>
</blockquote></div></div></div><div class="public anchor" id="var-mixer"><h3>mixer</h3><div class="usage"><code>(mixer state-key delay ts-key priority-fn &amp; children)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-moving-time-window"><h3>moving-time-window</h3><div class="usage"><code>(moving-time-window state-key n &amp; [time-key &amp; children :as all-children])</code></div><div class="doc"><div class="markdown"><p>Streamer function that propagate events to a vector of streamers using a moving time window delay </p>
<blockquote><p><strong>Arguments</strong>:<br/><em>state-key</em>: State key<br/><em>n</em>: Max number of events<br/><em>(time-key)</em>: Optional key holding the time i millis, default :time <em>&amp; children</em>: functions to propagate </p>
</blockquote></div></div></div><div class="public anchor" id="var-rate"><h3>rate</h3><div class="usage"><code>(rate state-key ts-key rate-key days bucket-size &amp; children)</code></div><div class="doc"><div class="markdown"><p>Stream function that matains a matrix fo <em>days</em> rows and 60*24 columns, and stores it in the state, then for each event that passes through increments the number in the position of row 0 and collum equals to the number of minute in the day, remainder rows contain past <em>days</em> minus 1 (days shold be less than 60 &lsquo;2 months&rsquo;). </p>
<blockquote><p><strong>Arguments</strong>:<br/><em>state-key</em>: Key of the state to hold the matrix<br/><em>ts-key</em>: keyword of the timestamp in millis<br/><em>rate-key</em>: keyword holding the matrix when the outgoing event is propagated to <em>children</em><br/><em>days</em>: Number of days to hold (number of rows in the matrix) <em>minutes2group</em>: number of minutes to group, larger numbers require less memory (ex: 15 means we know how many events are dividing the hour in 4 (15 minutes) it is required that this number divides 60 with no fraction(MEJORAR).<br/><em>children</em>: List of streams to propagate result<br/>&ndash; if event dosent have &lsquo;ts-key&rsquo; event is ignored!! </p>
</blockquote></div></div></div><div class="public anchor" id="var-reduce-with"><h3>reduce-with</h3><div class="usage"><code>(reduce-with state-key fun &amp; children)</code></div><div class="doc"><div class="markdown"><p>Streamer function that reduces values of an event using a function and propagates it</p>
<blockquote><p><strong>Arguments</strong>:<br/><em>state-key</em>: Key name to reduce<br/><em>fun</em>: function that reduces the values<br/><em>children</em>: Children streamer functions to be propagated </p>
</blockquote></div></div></div><div class="public anchor" id="var-rollup"><h3>rollup</h3><div class="usage"><code>(rollup state-key n dt &amp; children)</code></div><div class="doc"><div class="markdown"><p>Streamer function that propagates n events each dt time </p>
<blockquote><p><strong>Arguments</strong>:<br/><em>state-key</em>: Key name to roll back<br/><em>n</em>: Max number of elements stored<br/><em>dt</em>: Max time to perform operations <em>children</em>: Children streamer functions to be propagated </p>
</blockquote></div></div></div></div></body></html>